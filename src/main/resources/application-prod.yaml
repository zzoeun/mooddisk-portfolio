# 프로덕션 환경 설정
# ⚠️ 중요: 프로덕션 환경에서는 반드시 별도의 프로덕션 데이터베이스를 사용해야 합니다.
# 개발 환경과 완전히 분리된 환경 변수를 사용하여 실수로 개발 DB에 접근하는 것을 방지합니다.

spring:
  datasource:
    driver-class-name: org.mariadb.jdbc.Driver
    url: jdbc:mariadb://${DB_URL}:${DB_PORT}/${DB}?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Seoul
    username: ${DB_USER}
    password: ${DB_PASSWORD}

  # 프로덕션에서는 SQL 로깅 비활성화
  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate # 프로덕션에서는 validate만 사용
    properties:
      hibernate:
        format_sql: false
        show_sql: false
        use_sql_comments: false

  # 프로덕션에서는 CORS 설정 제한
  web:
    resources:
      add-mappings: true
      static-locations:
        - classpath:/static/
        - classpath:/public/
      chain:
        strategy:
          content:
            enabled: true
            paths: /**
        cache:
          enabled: true # 프로덕션에서는 캐싱 활성화

  # 파일 업로드 제한 - 프로덕션에서는 보안 강화
  servlet:
    multipart:
      max-file-size: 5MB # 개별 파일 최대 크기 (프로덕션 보안 강화)
      max-request-size: 15MB # 전체 요청 최대 크기 (3장 × 5MB)
      file-size-threshold: 2KB # 메모리 임계값
      location: /tmp # 임시 파일 저장 위치

  # 프로덕션 환경 S3 버킷 설정
cloud:
  aws:
    s3:
      buckets:
        upload:
          name: ${AWS_S3_UPLOAD_BUCKET} # 프로덕션용 업로드 버킷

server:
  port: 8080
  # 프로덕션 환경에서 스택 트레이스 비활성화 및 서버 정보 숨김
  error:
    include-stacktrace: never
    include-message: never
    include-binding-errors: never
    include-exception: false
    include-server-info: false
  # 프로덕션 환경에서 추가 보안 설정
  servlet:
    session:
      cookie:
        secure: true # HTTPS에서만 쿠키 전송
        http-only: true # JavaScript에서 쿠키 접근 방지
        same-site: strict # CSRF 방지

# JWT 토큰 설정 - 프로덕션에서는 보안 강화
jwt:
  expiration_time: 3600000 #60분

# 로깅 설정 - 프로덕션에서는 에러 레벨만
logging:
  level:
    root: WARN
    com.astro.mood: INFO
    org.springframework: WARN
    org.hibernate: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    org.hibernate.orm.jdbc.bind: WARN
    org.springframework.security: WARN
    org.springframework.web: WARN
    org.springframework.boot: WARN
  # 프로덕션에서는 민감한 정보 로깅 방지
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
